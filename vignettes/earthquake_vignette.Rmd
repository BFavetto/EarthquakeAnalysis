---
title: "Tools for earthquake analysis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tools for earthquake analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

This package handles the dataset about earthquakes provided by the [U.S. National Oceanographic and Atmospheric Administration (NOAA)](https://www.ngdc.noaa.gov/). It is made for educational purpose, as the final assignment of the Coursera MSDR Capstone project. 

# Install the package

```{r setup}
library(devtools)
install_github("BFavetto/EarthquakeAnalysis")
library(EarthquakeAnalysis)

library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)
```

# Load and clean the NOAA dataset

If there are several countries, a time line is plotted for each.

```{r loadcleandata}
# to load the data from the package
data("NOAAdata")

dataclean1 <- eq_clean_data(NOAAdata)
View(dataclean1)
dataclean2 <- eq_location_clean(dataclean1)
View(dataclean2)
```


# Plot a time line for earthquakes 

```{r plotimeline}
dataclean2 %>% filter((Year > 2010) &  (Country =="INDIA")) %>%
ggplot(  aes(x = Date,
           y = Country,
           color = Deaths,
           size = Mag)) + geom_timeline(alpha = 0.2)
```


# Plot a time line with labels

```{r}
dataclean2 %>% filter(Country %in% c("MEXICO", "IRAN") &
                      Date %within% interval(ymd(20000103),
                                                    ymd(20180104))) %>%
               mutate(Country = factor(Country, levels = unique(Country))) %>%
               ggplot() +
                    geom_timeline_label(aes(x = Date,
                                            y = Country,
                                            label = Location,
                                            magnitude = Mag,
                                            colour = Deaths,
                                            n_max = 7), alpha = 0.5) +
                               scale_colour_continuous(name = "Nb. of deaths") +
                               theme(legend.position = "bottom") +
                               ylab("")

```

